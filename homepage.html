<!DOCTYPE html>
{% autoescape true %}
<html>
<head><title>svgur.com - share SVG vector files</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="webmention" href="https://webmention.herokuapp.com/api/webmention" />
<link href="/static/style.css" media="all" rel="stylesheet" type="text/css" />
</head>  
<body >
  <nav><h1>svgur</h1> Upload, embed and share SVG vector files</nav>
  <form id=filereader action="{{upload_url}}" method="POST" enctype="multipart/form-data">
    <input class="choosesvg hidafter" id=file type="file" accept=".svg, image/svg+xml" name="file" value="Choose SVG">
    <div class="hidfirst "><input type="text" name="name" placeholder="Name it"></div>
    <div class=load-target ></div>
    <div class="hidfirst"><textarea name="summary" placeholder="describe the image"></textarea></div>
    <div class="hidfirst"><input type="submit"  name="submit" value="Share"></div>
    <textarea class="pngdata" name="pngfield" placeholder="png goes here">png?</textarea>
  </form>  
    <div class="preview"></div>
    <h2 class="hidafter">Recent Images</h2>
  <div id="recent" class="hidafter h-feed">
  {% for pic in pix %}
  <div class="picframe picgrid h-entry"><span class="e-content"><a class="u-url" title="{{pic.name}}" href="/s/{{pic.svgid}}" ><img class="pixpreview u-photo p-name" alt="{{pic.name}}" src="/i/{{pic.svgid}}.svg"  /></a><time class="dt-published" datetime="{{pic.published}}"></time></span></div>
  {% endfor %}
  </div>
<footer>made so you can easily upload, embed and share SVG vector files by <a href="http://kevinmarks.com">Kevin Marks</a>
<script id="webmention-hosted">
  (function () {
    var sn = document.createElement("script"), s = document.getElementsByTagName("script")[0], url;
    url = document.querySelectorAll ? document.querySelectorAll("link[rel~=canonical]") : false;
    url = url && url[0] ? url[0].href : false;
    sn.type = "text/javascript"; sn.async = true;
    sn.src = "//webmention.herokuapp.com/api/embed?version=cutting-edge&url=" + encodeURIComponent(url || window.location);
    s.parentNode.insertBefore(sn, s);
  }());
</script>
<script src="http://code.jquery.com/jquery-latest.js"></script>
<script src="/static/saveSvgAsPng.js"></script>
<script>
  function handleFileSelect(evt) {
    var $el = $('#filereader');
    var files = evt.target.files;
    for (var i = 0, f; f = files[i]; i++) {
      var reader = new FileReader();
      reader.onload = (function(file) {
        return function(e) {
          $el.find('.load-target').html(e.target.result);
          svgAsDataUri($el.find('.load-target svg')[0], null, function(uri) {
            $('.hidafter').hide();
            $el.find('.hidfirst').show();
            var image = new Image();
            image.src = uri;
            image.onload = function() {
                var canvas = document.createElement('canvas');
                // use current magic sizes for facebook twitter ie 1200, but preserve ratio
                canvas.width = 1200; //image.width;
                canvas.height = 1200*image.height/image.width; //image.height;
                var context = canvas.getContext('2d');
                // 
                context.drawImage(image, 0, 0,1200,canvas.height); //will need a fitrect
                var pngdata = canvas.toDataURL('image/png');
                $('.preview').html('<img src="' + pngdata + '" />');
                $('.pngdata').html(pngdata);
                }
          });
        }
      })(f);
      reader.readAsText(f);
    }
  }

  if (window.File && window.FileReader && window.FileList && window.Blob) {
    document.getElementById('file').addEventListener('change', handleFileSelect, false);
  }
  $( document ).ready(function() {
    $('.hidfirst').hide();
  });
</script>
</body>
</html>
{% endautoescape %}